<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ó–∞ —Ç–µ–±, —Å –ª—é–±–æ–≤ ü´ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --yellow:#FFD93D; --pink:#FF6B9D; --purple:#A855F7;
      --blue:#4ECDC4; --orange:#FF9A3C; --green:#6BCB77;
      --red:#FF5757; --cream:#FFFBF0; --ink:#2D2D2D;
      --ink-soft:#6B5E5E; --radius:20px;
      --font-display:'Fredoka One',cursive;
      --font-body:'Nunito',sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{background:var(--cream);color:var(--ink);font-family:var(--font-body);overflow-x:hidden}
    body::before{content:'';position:fixed;inset:0;background-image:
      radial-gradient(circle at 15% 20%,rgba(255,107,157,.10) 0%,transparent 40%),
      radial-gradient(circle at 85% 15%,rgba(78,205,196,.10) 0%,transparent 40%),
      radial-gradient(circle at 10% 80%,rgba(168,85,247,.08) 0%,transparent 40%),
      radial-gradient(circle at 90% 75%,rgba(255,217,61,.12) 0%,transparent 40%);
      pointer-events:none;z-index:0}

    .petals-container{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
    .petal{position:absolute;top:-80px;animation:fallDown linear infinite;user-select:none}
    @keyframes fallDown{0%{transform:translateY(0) rotate(0);opacity:0}5%{opacity:1}100%{transform:translateY(110vh) rotate(720deg) translateX(60px);opacity:0}}

    .nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;
      justify-content:space-between;padding:.8rem 1.5rem;
      background:rgba(255,251,240,.92);backdrop-filter:blur(14px);
      border-bottom:3px solid transparent;
      border-image:linear-gradient(90deg,var(--pink),var(--yellow),var(--blue),var(--purple)) 1}
    .nav-logo{font-family:var(--font-display);font-size:1.3rem;
      background:linear-gradient(135deg,var(--pink),var(--purple));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .nav-links{display:flex;gap:.4rem}
    .nav-link{font-family:var(--font-body);font-size:.78rem;font-weight:700;letter-spacing:.06em;
      text-transform:uppercase;color:var(--ink-soft);text-decoration:none;
      padding:.4rem .9rem;border-radius:50px;transition:all .2s}
    .nav-link:hover,.nav-link.active{background:linear-gradient(135deg,var(--pink),var(--orange));
      color:white;transform:translateY(-2px)}

    .hero{min-height:100vh;display:grid;grid-template-columns:1fr 1fr;
      align-items:center;padding:7rem 5vw 4rem;position:relative;z-index:1;gap:2rem}
    .hero-eyebrow{font-size:.85rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
      color:var(--pink);margin-bottom:.8rem;display:flex;align-items:center;gap:.4rem}
    .hero-eyebrow::before,.hero-eyebrow::after{content:'‚ú¶';color:var(--yellow)}
    .hero-title{font-family:var(--font-display);font-size:clamp(2.5rem,6vw,5.5rem);
      line-height:1.1;color:var(--ink);margin-bottom:1.2rem}
    .hero-title em{font-style:normal;background:linear-gradient(135deg,var(--pink),var(--purple),var(--blue));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .hero-sub{font-size:1rem;color:var(--ink-soft);font-weight:600}
    .hero-jar{font-size:clamp(4rem,12vw,10rem);text-align:center;
      animation:floatJar 3s ease-in-out infinite;
      filter:drop-shadow(0 10px 28px rgba(255,107,157,.25))}
    @keyframes floatJar{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-16px) rotate(3deg)}}

    .section{padding:5rem 5vw;position:relative;z-index:1}
    .alt-section{background:linear-gradient(180deg,rgba(78,205,196,.06) 0%,rgba(255,107,157,.04) 100%)}
    .section-title{font-family:var(--font-display);font-size:clamp(2rem,4vw,3rem);
      color:var(--ink);margin-bottom:.5rem;text-align:center;
      display:inline-block;position:relative;left:50%;transform:translateX(-50%)}
    .section-title::after{content:'';display:block;height:4px;border-radius:2px;
      background:linear-gradient(90deg,var(--pink),var(--yellow),var(--blue));margin-top:.4rem}
    .section-title em{font-style:normal;color:var(--pink)}
    .section-sub{text-align:center;color:var(--ink-soft);font-size:.95rem;font-weight:600;
      margin-bottom:2.5rem;margin-top:.5rem}

    .mood-selector{text-align:center;margin-bottom:2.5rem}
    .mood-label{font-family:var(--font-display);font-size:1.5rem;color:var(--ink);margin-bottom:1rem}
    .mood-tabs{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:center}
    .mood-tab{font-family:var(--font-body);font-size:.85rem;font-weight:700;
      padding:.55rem 1.2rem;border:3px solid rgba(0,0,0,.12);border-radius:50px;
      background:white;color:var(--ink);cursor:pointer;
      transition:all .22s cubic-bezier(.34,1.56,.64,1);box-shadow:0 3px 10px rgba(0,0,0,.08)}
    .mood-tab:hover{transform:translateY(-4px) scale(1.05)}
    .mood-tab.active{background:var(--clr);border-color:var(--clr);
      transform:translateY(-4px) scale(1.06);box-shadow:4px 4px 0 var(--ink)}

    .jar-area{display:flex;justify-content:center;margin-bottom:2rem}
    .jar-visual{position:relative;width:150px;cursor:pointer;transition:transform .3s}
    .jar-visual:hover{transform:scale(1.06) rotate(2deg)}
    .jar-lid{width:100px;height:22px;background:linear-gradient(135deg,var(--orange),var(--yellow));
      border-radius:12px 12px 0 0;margin:0 auto;border:3px solid var(--ink);border-bottom:none}
    .jar-body{width:150px;height:180px;
      background:linear-gradient(160deg,rgba(255,255,255,.85) 0%,rgba(255,251,240,.70) 100%);
      border:3px solid var(--ink);border-radius:14px 14px 32px 32px;
      display:flex;align-items:flex-end;justify-content:center;
      overflow:hidden;padding-bottom:10px;
      box-shadow:inset 5px 0 14px rgba(255,255,255,.5),4px 6px 0 var(--ink);position:relative}
    .jar-body::before{content:'';position:absolute;top:10px;left:14px;width:16px;bottom:10px;
      background:linear-gradient(180deg,rgba(255,255,255,.6) 0%,rgba(255,255,255,0) 100%);border-radius:8px}
    .notes-pile{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;align-items:flex-end;padding:0 8px;width:100%}
    .mini-note{width:26px;height:20px;border-radius:4px;border:2px solid rgba(0,0,0,.15)}
    .jar-visual.shake{animation:jarShake .5s ease}
    @keyframes jarShake{0%{transform:rotate(0)}15%{transform:rotate(-8deg) scale(1.05)}30%{transform:rotate(8deg) scale(1.06)}45%{transform:rotate(-5deg)}60%{transform:rotate(5deg)}75%{transform:rotate(-2deg)}100%{transform:rotate(0)}}

    .note-display{display:flex;flex-direction:column;align-items:center;gap:1.5rem;max-width:500px;margin:0 auto}
    .note-card{width:100%;min-height:130px;background:var(--yellow);
      border-radius:var(--radius);border:3px solid var(--ink);
      padding:1.8rem 2rem;display:flex;align-items:center;justify-content:center;
      text-align:center;box-shadow:5px 6px 0 var(--ink);transition:background .35s;position:relative}
    .note-card::before{content:'¬∑ ¬∑ ¬∑';position:absolute;top:10px;right:14px;
      font-size:1.1rem;color:rgba(0,0,0,.12);letter-spacing:.3em}
    .note-text{font-family:var(--font-body);font-size:1.05rem;font-weight:600;line-height:1.65;color:var(--ink)}
    .note-card.pop{animation:popNote .4s cubic-bezier(.36,.07,.19,.97)}
    @keyframes popNote{0%{transform:scale(.93) rotate(-1deg)}50%{transform:scale(1.04) rotate(1deg)}100%{transform:scale(1) rotate(0)}}
    .draw-btn{font-family:var(--font-display);font-size:1rem;padding:.8rem 2.5rem;
      background:linear-gradient(135deg,var(--pink),var(--purple));
      color:white;border:3px solid var(--ink);border-radius:50px;cursor:pointer;
      box-shadow:4px 4px 0 var(--ink);transition:all .22s cubic-bezier(.34,1.56,.64,1)}
    .draw-btn:hover{transform:translateY(-4px) scale(1.04);box-shadow:6px 8px 0 var(--ink)}

    /* ADD FORM */
    .add-form{max-width:600px;margin:0 auto 3rem;background:white;
      border-radius:var(--radius);border:3px solid var(--ink);
      padding:2rem;box-shadow:5px 6px 0 var(--ink)}
    .add-form-title{font-family:var(--font-display);font-size:1.4rem;margin-bottom:.5rem;color:var(--ink)}
    .add-form-hint{font-size:.82rem;color:var(--ink-soft);font-weight:600;margin-bottom:1.2rem;
      background:rgba(255,217,61,.3);padding:.6rem 1rem;border-radius:10px;border-left:3px solid var(--yellow)}
    .add-form-hint a{color:var(--pink);font-weight:700}
    .upload-fields{display:flex;flex-direction:column;gap:.8rem}
    .upload-input{padding:.7rem 1rem;border:2.5px solid var(--ink);border-radius:12px;
      font-family:var(--font-body);font-size:.95rem;outline:none;background:white}
    .upload-input:focus{border-color:var(--pink);box-shadow:0 0 0 3px rgba(255,107,157,.15)}
    textarea.upload-input{resize:vertical;min-height:120px}
    .upload-btn{padding:.75rem 2rem;background:linear-gradient(135deg,var(--green),var(--blue));
      color:white;border:2.5px solid var(--ink);border-radius:50px;
      font-family:var(--font-display);font-size:1rem;cursor:pointer;
      box-shadow:3px 3px 0 var(--ink);transition:all .2s;align-self:flex-start}
    .upload-btn:hover{transform:translateY(-3px);box-shadow:5px 5px 0 var(--ink)}
    .upload-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}

    /* PREVIEW */
    .img-preview{width:100%;max-height:200px;object-fit:cover;border-radius:12px;
      border:2.5px solid var(--ink);display:none}

    /* GALLERY */
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:1.2rem;max-width:1100px;margin:0 auto}
    .gallery-item{position:relative;border-radius:var(--radius);overflow:hidden;
      cursor:pointer;aspect-ratio:4/3;border:3px solid var(--ink);
      box-shadow:5px 6px 0 var(--ink);transition:transform .25s cubic-bezier(.34,1.56,.64,1),box-shadow .25s}
    .gallery-item:hover{transform:translateY(-6px) rotate(-1deg);box-shadow:8px 10px 0 var(--ink)}
    .gallery-item img{width:100%;height:100%;object-fit:cover;transition:transform .4s}
    .gallery-item:hover img{transform:scale(1.08)}
    .gallery-overlay{position:absolute;inset:0;
      background:linear-gradient(to top,rgba(30,10,10,.75) 0%,transparent 55%);
      display:flex;flex-direction:column;justify-content:flex-end;
      padding:1rem;opacity:0;transition:opacity .3s}
    .gallery-item:hover .gallery-overlay{opacity:1}
    .gallery-caption{color:white;font-weight:700;font-size:.9rem}
    .gallery-date{color:rgba(255,255,255,.75);font-size:.72rem;font-weight:600}
    .del-btn{position:absolute;top:8px;right:8px;background:var(--red);color:white;
      border:2px solid white;border-radius:50%;width:28px;height:28px;
      font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;
      opacity:0;transition:opacity .2s;z-index:2}
    .gallery-item:hover .del-btn{opacity:1}
    .empty-msg{grid-column:1/-1;text-align:center;padding:3rem;color:var(--ink-soft);
      font-weight:600;border:3px dashed rgba(0,0,0,.15);border-radius:var(--radius)}

    .lightbox{position:fixed;inset:0;background:rgba(20,10,5,.92);z-index:200;
      display:flex;align-items:center;justify-content:center;
      flex-direction:column;gap:1rem;opacity:0;pointer-events:none;transition:opacity .3s}
    .lightbox.open{opacity:1;pointer-events:all}
    .lightbox-img{max-width:90vw;max-height:80vh;border-radius:var(--radius);
      border:4px solid white;box-shadow:0 20px 80px rgba(0,0,0,.5);transition:opacity .2s}
    .lightbox-caption{color:rgba(255,255,255,.85);font-weight:700}
    .lightbox-close{position:absolute;top:1.5rem;right:2rem;background:var(--pink);
      border:3px solid white;color:white;width:40px;height:40px;border-radius:50%;
      cursor:pointer;transition:transform .2s;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem}
    .lightbox-close:hover{transform:scale(1.15) rotate(90deg)}
    .lightbox-nav{position:absolute;top:50%;transform:translateY(-50%);
      background:var(--yellow);border:3px solid var(--ink);color:var(--ink);
      font-size:1.6rem;width:50px;height:50px;border-radius:50%;cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      box-shadow:3px 3px 0 var(--ink);font-weight:700;transition:transform .2s}
    .lightbox-nav:hover{transform:translateY(-50%) scale(1.12)}
    .lightbox-nav.prev{left:1.5rem}
    .lightbox-nav.next{right:1.5rem}

    .stories-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:1.2rem;max-width:1100px;margin:0 auto}
    .story-card{background:white;border-radius:var(--radius);padding:1.6rem;
      border:3px solid var(--ink);border-top-width:6px;
      box-shadow:5px 6px 0 var(--ink);transition:transform .25s cubic-bezier(.34,1.56,.64,1),box-shadow .25s;
      display:flex;flex-direction:column;gap:.5rem;position:relative}
    .story-card:hover{transform:translateY(-5px) rotate(1deg);box-shadow:8px 10px 0 var(--ink)}
    .story-emoji{font-size:1.8rem}
    .story-date{font-size:.73rem;letter-spacing:.1em;text-transform:uppercase;color:var(--pink);font-weight:700}
    .story-title{font-family:var(--font-display);font-size:1.2rem;color:var(--ink)}
    .story-preview{font-size:.85rem;color:var(--ink-soft);line-height:1.6;flex:1;font-weight:600}
    .story-read-btn{margin-top:.8rem;align-self:flex-start;font-family:var(--font-display);
      font-size:.88rem;padding:.45rem 1.2rem;border-radius:50px;border:2.5px solid var(--ink);
      background:var(--yellow);color:var(--ink);cursor:pointer;
      box-shadow:3px 3px 0 var(--ink);transition:all .2s}
    .story-read-btn:hover{background:var(--pink);color:white;transform:translateY(-3px)}
    .story-del-btn{position:absolute;top:10px;right:10px;background:var(--red);color:white;
      border:2px solid var(--ink);border-radius:50%;width:26px;height:26px;
      font-size:.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;
      box-shadow:2px 2px 0 var(--ink);opacity:0;transition:opacity .2s}
    .story-card:hover .story-del-btn{opacity:1}

    .story-modal{position:fixed;inset:0;background:rgba(20,10,5,.75);z-index:200;
      display:flex;align-items:center;justify-content:center;padding:1.5rem;
      opacity:0;pointer-events:none;transition:opacity .3s;backdrop-filter:blur(6px)}
    .story-modal.open{opacity:1;pointer-events:all}
    .story-modal-inner{background:var(--cream);border-radius:28px;max-width:600px;width:100%;
      max-height:82vh;overflow-y:auto;padding:2.5rem;position:relative;
      border:3px solid var(--ink);box-shadow:8px 10px 0 var(--ink)}
    .story-close{position:absolute;top:1rem;right:1rem;background:var(--red);
      border:2.5px solid var(--ink);color:white;width:34px;height:34px;border-radius:50%;
      cursor:pointer;display:flex;align-items:center;justify-content:center;
      font-weight:700;box-shadow:2px 2px 0 var(--ink);transition:transform .2s}
    .story-close:hover{transform:scale(1.12) rotate(90deg)}
    .story-modal-emoji{font-size:2.5rem;margin-bottom:.5rem}
    .story-modal-title{font-family:var(--font-display);font-size:1.8rem;color:var(--ink);margin-bottom:.3rem}
    .story-modal-date{font-size:.76rem;letter-spacing:.12em;text-transform:uppercase;color:var(--pink);font-weight:700;margin-bottom:1.2rem}
    .story-modal-body{font-size:.98rem;line-height:1.85;color:var(--ink);font-weight:600;white-space:pre-wrap}

    .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);
      background:var(--ink);color:white;padding:.8rem 2rem;border-radius:50px;
      font-weight:700;z-index:999;transition:transform .3s;pointer-events:none;white-space:nowrap}
    .toast.show{transform:translateX(-50%) translateY(0)}

    .footer{text-align:center;padding:2rem;font-family:var(--font-display);font-size:1rem;
      background:linear-gradient(135deg,var(--pink),var(--purple),var(--blue));color:white}

    @media(max-width:768px){
      .hero{grid-template-columns:1fr;text-align:center;padding-top:6rem;gap:1rem}
      .hero-eyebrow{justify-content:center}
      .hero-jar{order:-1;font-size:4.5rem}
      .nav{padding:.7rem 1rem}
      .nav-links{gap:.2rem}
      .nav-link{font-size:.72rem;padding:.35rem .7rem}
      .section{padding:4rem 1rem}
    }
    @media(max-width:480px){
      .mood-tab{font-size:.78rem;padding:.42rem .85rem}
      .gallery-grid{grid-template-columns:1fr 1fr;gap:.7rem}
    }
  </style>
</head>
<body>

  <div class="petals-container" id="petals"></div>

  <nav class="nav">
    <div class="nav-logo">ü´ô –ó–∞ —Ç–µ–±</div>
    <div class="nav-links">
      <a href="#jar-section"     class="nav-link active" data-section="jar">–õ–∏—Å—Ç—á–µ—Ç–∞</a>
      <a href="#gallery-section" class="nav-link"        data-section="gallery">–°–Ω–∏–º–∫–∏</a>
      <a href="#stories-section" class="nav-link"        data-section="stories">–ò—Å—Ç–æ—Ä–∏–π–∫–∏</a>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-content">
      <p class="hero-eyebrow">–°–ü–ï–¶–ò–ê–õ–ù–û –ó–ê</p>
      <h1 class="hero-title">—Ç–µ–±,<br/><em>—Å —Ü—è–ª–∞—Ç–∞ –º–∏ –ª—é–±–æ–≤</em></h1>
      <p class="hero-sub">–ò–∑–±–µ—Ä–∏ –ª–∏—Å—Ç—á–µ —Å–ø—Ä—è–º–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ—Ç–æ —Å–∏ ‚ô°</p>
    </div>
    <div class="hero-jar">ü´ô</div>
  </section>

  <section class="section" id="jar-section">
    <div class="mood-selector">
      <p class="mood-label">–ö–∞–∫ —Å–µ —á—É–≤—Å—Ç–≤–∞—à —Å–µ–≥–∞?</p>
      <div class="mood-tabs">
        <button class="mood-tab active" data-mood="happy"     style="--clr:#FFD93D">üòä –©–∞—Å—Ç–ª–∏–≤–∞</button>
        <button class="mood-tab"        data-mood="sad"       style="--clr:#90B4CE">üò¢ –¢—ä–∂–Ω–∞</button>
        <button class="mood-tab"        data-mood="angry"     style="--clr:#FF5757">üò§ –Ø–¥–æ—Å–∞–Ω–∞</button>
        <button class="mood-tab"        data-mood="tired"     style="--clr:#6BCB77">üò¥ –ò–∑–º–æ—Ä–µ–Ω–∞</button>
        <button class="mood-tab"        data-mood="motivated" style="--clr:#FF9A3C">üî• –ù—É–∂–¥–∞ –æ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—è</button>
        <button class="mood-tab"        data-mood="insecure"  style="--clr:#FF6B9D">üå∏ –ù–µ—Å–∏–≥—É—Ä–Ω–∞</button>
      </div>
    </div>
    <div class="jar-area">
      <div class="jar-visual" id="jarVisual">
        <div class="jar-body"><div class="notes-pile" id="notesPile"></div></div>
        <div class="jar-lid"></div>
      </div>
    </div>
    <div class="note-display">
      <div class="note-card" id="noteCard">
        <p class="note-text" id="noteText">–ú–æ–∂–µ—à –¥–∞ –Ω–∞—Ç–∏—Å–Ω–∏ –≤—ä—Ä—Ö—É –±—É—Ä–∫–∞–Ω–∞ –∑–∞ –¥–∞ –∏–∑–≤–∞–¥–∏—à –ª–∏—Å—Ç—á–µ ‚ô°</p>
      </div>
      <button class="draw-btn" id="drawBtn">–ò–∑–≤–∞–¥–∏ –ª–∏—Å—Ç—á–µ</button>
    </div>
  </section>

  <!-- –°–ù–ò–ú–ö–ò -->
  <section class="section alt-section" id="gallery-section">
    <h2 class="section-title">–ù–∞—à–∏ —Å–Ω–∏–º–∫–∏ <em>‚ô°</em></h2>
    <p class="section-sub">–õ—é–±–∏–º–∏—Ç–µ –Ω–∏ –º–æ–º–µ–Ω—Ç–∏ –∑–∞–µ–¥–Ω–æ</p>

    <div class="add-form">
      <p class="add-form-title">üì∏ –î–æ–±–∞–≤–∏ —Å–Ω–∏–º–∫–∞</p>
      <p class="add-form-hint">
        –ö–∞—á–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ –≤ <a href="https://imgur.com/upload" target="_blank">imgur.com</a> ‚Üí
        –∫–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫–∞ ‚Üí –ø–æ—Å—Ç–∞–≤–∏ –≥–æ —Ç—É–∫. –û—Ç —Ç–µ–ª–µ—Ñ–æ–Ω: –ì–∞–ª–µ—Ä–∏—è ‚Üí –°–ø–æ–¥–µ–ª–∏ ‚Üí –ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫ –æ—Ç Google Photos.
      </p>
      <div class="upload-fields">
        <input class="upload-input" id="photoUrl"     placeholder="–õ–∏–Ω–∫ –∫—ä–º —Å–Ω–∏–º–∫–∞—Ç–∞ (https://...)"/>
        <img  class="img-preview"   id="imgPreview"   src="" alt="–ø—Ä–µ–≥–ª–µ–¥"/>
        <input class="upload-input" id="photoCaption" placeholder="–ü–æ–¥–ø–∏—Å (–ø–æ –∏–∑–±–æ—Ä)..."/>
        <input class="upload-input" id="photoDate"    placeholder="–î–∞—Ç–∞ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ (–ø–æ –∏–∑–±–æ—Ä)..."/>
        <button class="upload-btn"  id="addPhotoBtn">–î–æ–±–∞–≤–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ üíï</button>
      </div>
    </div>

    <div class="gallery-grid" id="galleryGrid">
      <div class="empty-msg">üì∏ –í—Å–µ –æ—â–µ –Ω—è–º–∞ —Å–Ω–∏–º–∫–∏!</div>
    </div>
    <div class="lightbox" id="lightbox">
      <button class="lightbox-close" id="lightboxClose">‚úï</button>
      <button class="lightbox-nav prev" id="lightboxPrev">‚Äπ</button>
      <img class="lightbox-img" id="lightboxImg" src="" alt=""/>
      <p class="lightbox-caption" id="lightboxCaption"></p>
      <button class="lightbox-nav next" id="lightboxNext">‚Ä∫</button>
    </div>
  </section>

  <!-- –ò–°–¢–û–†–ò–ô–ö–ò -->
  <section class="section" id="stories-section">
    <h2 class="section-title">–ò—Å—Ç–æ—Ä–∏–π–∫–∏ <em>‚ô°</em></h2>
    <p class="section-sub">–ú–æ–º–µ–Ω—Ç–∏, –¥—É–º–∏ –∏ –≤—Å–∏—á–∫–æ –º–µ–∂–¥—É –Ω–∞—Å</p>

    <div class="add-form">
      <p class="add-form-title">‚úçÔ∏è –î–æ–±–∞–≤–∏ –∏—Å—Ç–æ—Ä–∏–π–∫–∞</p>
      <div class="upload-fields">
        <input class="upload-input" id="storyTitle"   placeholder="–ó–∞–≥–ª–∞–≤–∏–µ..."/>
        <input class="upload-input" id="storyDate"    placeholder="–î–∞—Ç–∞"/>
        <input class="upload-input" id="storyPreview" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ..."/>
        <textarea class="upload-input" id="storyContent" placeholder="–ü—ä–ª–µ–Ω —Ç–µ–∫—Å—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞..."></textarea>
        <button class="upload-btn" id="addStoryBtn">–ó–∞–ø–∞–∑–∏ –∏—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞ üíï</button>
      </div>
    </div>

    <div class="stories-grid" id="storiesGrid">
      <div class="empty-msg">‚úçÔ∏è –í—Å–µ –æ—â–µ –Ω—è–º–∞ –∏—Å—Ç–æ—Ä–∏–π–∫–∏!</div>
    </div>
  </section>

  <div class="story-modal" id="storyModal">
    <div class="story-modal-inner">
      <button class="story-close" id="storyClose">‚úï</button>
      <div id="storyModalContent"></div>
    </div>
  </div>

  <footer class="footer"><p>–ù–∞–ø—Ä–∞–≤–µ–Ω–æ —Å ‚ô• —Å–ø–µ—Ü–∏–∞–ª–Ω–æ –∑–∞ —Ç–µ–±, –ª—è–±–æ–≤</p></footer>
  <div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy }
  from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:            "AIzaSyCsWP4CmP8WMzuH0a_Xfd_4w-b2pHrF_7k",
  authDomain:        "love-jar-ce40e.firebaseapp.com",
  projectId:         "love-jar-ce40e",
  storageBucket:     "love-jar-ce40e.firebasestorage.app",
  messagingSenderId: "777717972348",
  appId:             "1:777717972348:web:83f4c7a384beab57da78f9"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

let photos = [], stories = [], currentPhotoIdx = 0;
let currentMood = 'happy', shownNotes = {};

document.addEventListener('DOMContentLoaded', () => {
  createPetals();
  initMoodTabs();
  initJar();
  initNavSmooth();
  initLightbox();
  initStoryModal();
  initPhotoForm();
  initStoryForm();
  renderNotesPile();
  loadPhotos();
  loadStories();
});

function createPetals() {
  const c = document.getElementById('petals');
  const s = ['üå∏','üå∫','‚≠ê','üíõ','üíú','ü©µ','üåº','‚ú¶'];
  for (let i = 0; i < 18; i++) {
    const p = document.createElement('span'); p.className = 'petal';
    p.textContent = s[Math.floor(Math.random() * s.length)];
    p.style.left = Math.random() * 100 + 'vw';
    p.style.animationDuration = (9 + Math.random() * 12) + 's';
    p.style.animationDelay = (Math.random() * 14) + 's';
    p.style.fontSize = (0.7 + Math.random() * 1.2) + 'rem';
    p.style.opacity = 0.2 + Math.random() * 0.3;
    c.appendChild(p);
  }
}

const NOTES = {
  happy:     { color:"#FFD93D", messages:["–¢–≤–æ—è—Ç–∞ —É—Å–º–∏–≤–∫–∞ –µ –ª—é–±–∏–º–∞—Ç–∞ –º–∏ –≥–ª–µ–¥–∫–∞. –†–∞–¥–≤–∞–º —Å–µ, —á–µ –¥–Ω–µ—Å —Å–∏—è–µ—à!","–ó–∞–ø–∞–∑–∏ —Ç–æ–∑–∏ –º–æ–º–µ–Ω—Ç –≤ —Å—ä—Ä—Ü–µ—Ç–æ —Å–∏. –¢–∏ –∑–∞—Å–ª—É–∂–∞–≤–∞—à —Ü—è–ª–æ—Ç–æ —â–∞—Å—Ç–∏–µ –Ω–∞ —Å–≤–µ—Ç–∞.","–¢–≤–æ—è—Ç —Å–º—è—Ö –µ –Ω–∞–π-—Ö—É–±–∞–≤–∞—Ç–∞ –º–µ–ª–æ–¥–∏—è. –ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π –¥–∞ –æ–∑–∞—Ä—è–≤–∞—à –¥–µ–Ω—è –º–∏!","–©–∞—Å—Ç–∏–µ—Ç–æ —Ç–∏ –æ—Ç–∏–≤–∞ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–Ω–æ–≥–æ. –ù–µ —Å–ø–∏—Ä–∞–π –¥–∞ —Å–µ —É—Å–º–∏—Ö–≤–∞—à, –ª—é–±–æ–≤ –º–æ—è!","–¢–æ–ª–∫–æ–≤–∞ —Å–µ —Ä–∞–¥–≤–∞–º –∑–∞ —Ç–µ–±! –¢–≤–æ—è—Ç–∞ —Ä–∞–¥–æ—Å—Ç –µ –∏ –º–æ—è —Ä–∞–¥–æ—Å—Ç.","–î–Ω–µ—Å —Å–≤–µ—Ç—ä—Ç –µ –ø–æ-–∫—Ä–∞—Å–∏–≤, –∑–∞—â–æ—Ç–æ —Ç–∏ —Å–∏ —â–∞—Å—Ç–ª–∏–≤–∞. –û–±–∏—á–∞–º —Ç–µ!","–¢–∏ —Å–∏ –º–æ–µ—Ç–æ —Å–ª—ä–Ω—Ü–µ, –∫–æ–µ—Ç–æ —Å–∏—è–µ –ø–æ-—Å–∏–ª–Ω–æ –∫–æ–≥–∞—Ç–æ —Å–∏ —â–∞—Å—Ç–ª–∏–≤–∞.","–ù–∞—Å–ª–∞–¥–∏ —Å–µ –Ω–∞ –≤—Å–µ–∫–∏ –º–∏–≥ –æ—Ç —Ç–æ–∑–∏ –ø—Ä–µ–∫—Ä–∞—Å–µ–Ω –¥–µ–Ω. –¢–∏ –≥–æ –∑–∞—Å–ª—É–∂–∞–≤–∞—à!","–¢–≤–æ–µ—Ç–æ —â–∞—Å—Ç–∏–µ –µ –º–æ—è—Ç–∞ –Ω–∞–π-–≥–æ–ª—è–º–∞ –º–∏—Å–∏—è. –†–∞–¥–≤–∞–º —Å–µ, —á–µ –¥–Ω–µ—Å —Å–∏ –Ω–∞ –≤—ä—Ä—Ö–∞!","–ù–∞–¥—è–≤–∞–º —Å–µ —Ç–æ–∑–∏ –æ–ø—Ç–∏–º–∏–∑—ä–º —Ç–µ –¥—ä—Ä–∂–∏ –ø—Ä–µ–∑ —Ü–µ–ª–∏—è –¥–µ–Ω. –¢–∏ —Å–∏ —É–Ω–∏–∫–∞–ª–Ω–∞!"] },
  sad:       { color:"#90B4CE", messages:["–î–æ —Ç–µ–± —Å—ä–º. –ù–µ –∑–∞–±—Ä–∞–≤—è–π, —á–µ —Å–ª–µ–¥ –≤—Å—è–∫–∞ –±—É—Ä—è –∏–∑–≥—Ä—è–≤–∞ —Å–ª—ä–Ω—Ü–µ.","–ü–æ–∑–≤–æ–ª–∏ —Å–∏ –¥–∞ –±—ä–¥–µ—à —Ç—ä–∂–Ω–∞, –Ω–æ –Ω–µ –∑–∞–±—Ä–∞–≤—è–π –∫–æ–ª–∫–æ —Å–∏–ª–Ω–∞ —Å–∏ –≤—Å—ä—â–Ω–æ—Å—Ç.","–ò–∑–ø—Ä–∞—â–∞–º —Ç–∏ –Ω–∞–π-–≥–æ–ª—è–º–∞—Ç–∞ —Å–∏ –ø–æ–¥–∫—Ä–µ–ø–∞. –í—Å–∏—á–∫–æ —â–µ —Å–µ –æ–ø—Ä–∞–≤–∏, –æ–±–µ—â–∞–≤–∞–º —Ç–∏.","–¢–≤–æ—è—Ç–∞ –±–æ–ª–∫–∞ –µ –∏ –º–æ—è. –ù–µ —Å–∏ —Å–∞–º–∞ –≤ —Ç–æ–≤–∞, –∞–∑ —Å—ä–º —Ç–≤–æ—è—Ç–∞ –æ–ø–æ—Ä–∞.","–ü–æ–µ–º–∏ —Å–∏ –¥—ä—Ö. –ü–æ–º–Ω–∏, —Ç–∏ —Å–∏ —Ü–µ–Ω–Ω–∞ –∏ –æ–±–∏—á–∞–Ω–∞, –¥–æ—Ä–∏ –≤ –Ω–∞–π-—Ç—Ä—É–¥–Ω–∏—Ç–µ –º–æ–º–µ–Ω—Ç–∏.","–ò—Å–∫–∞–º –¥–∞ –∏–∑—Ç—Ä–∏—è –≤—Å—è–∫–∞ —Ç–≤–æ—è —Å—ä–ª–∑–∞. –¢–∏ —Å–∏ —É–Ω–∏–∫–∞–ª–Ω–∞, –≥–æ—Ä–µ –≥–ª–∞–≤–∞—Ç–∞, –º–∏–ª–∏—á–∫–∞!","–î–Ω–µ—Å –º–æ–∂–µ –¥–∞ –µ —Ç—Ä—É–¥–Ω–æ, –Ω–æ —É—Ç—Ä–µ —â–µ –±—ä–¥–µ –ø–æ-–ª–µ—Å–Ω–æ. –í—è—Ä–≤–∞–º –≤ —Ç–µ–±.","–ù–µ –∑–∞–±—Ä–∞–≤—è–π –∫–æ–ª–∫–æ –º–Ω–æ–≥–æ —Ö–æ—Ä–∞ —Ç–µ –æ–±–∏—á–∞—Ç, –∞ –∞–∑ –Ω–∞–π-–º–Ω–æ–≥–æ –æ—Ç –≤—Å–∏—á–∫–∏.","–í—Å–∏—á–∫–æ –ø—Ä–µ–º–∏–Ω–∞–≤–∞, –ª—é–±–æ–≤ –º–æ—è. –ù–µ–∫–∞ —Ç–∞–∑–∏ –±–µ–ª–µ–∂–∫–∞ —Ç–∏ –Ω–∞–ø–æ–º–Ω–∏, —á–µ —Å–∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞.","–ü—Ä–æ—Å—Ç–æ –∏—Å–∫–∞–º –¥–∞ –∑–Ω–∞–µ—à, —á–µ –≤–∏–Ω–∞–≥–∏ –º–æ–∂–µ—à –¥–∞ —Ä–∞–∑—á–∏—Ç–∞—à –Ω–∞ –º–µ–Ω. –û–±–∏—á–∞–º —Ç–µ!"] },
  angry:     { color:"#FF5757", messages:["–ü–æ–µ–º–∏ –¥—ä–ª–±–æ–∫–æ –≤—ä–∑–¥—É—Ö. –ù–µ –ø–æ–∑–≤–æ–ª—è–≤–∞–π –Ω–∞ –≥–Ω–µ–≤–∞ –¥–∞ –∑–∞—Å–µ–Ω—á–∏ —Ç–≤–æ—è—Ç–∞ —Å–≤–µ—Ç–ª–∏–Ω–∞.","–ó–Ω–∞–º, —á–µ –µ —Ç—Ä—É–¥–Ω–æ, –Ω–æ —Ç–∏ —Å–∏ –ø–æ-—É–º–Ω–∞ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏—è—Ç–∞. –ù–µ –ø–∞–¥–∞–π –Ω–∞ –Ω–∏–≤–æ—Ç–æ –∏–º.","–í—Å–∏—á–∫–æ —â–µ —Å–µ –Ω–∞—Ä–µ–¥–∏. –ù–µ —Ö–∞–±–∏ –µ–Ω–µ—Ä–≥–∏—è—Ç–∞ —Å–∏ –∑–∞ –Ω–µ—â–∞, –∫–æ–∏—Ç–æ –Ω–µ –∑–∞—Å–ª—É–∂–∞–≤–∞—Ç.","–ò–º–∞–π –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞–¥ –µ–º–æ—Ü–∏–∏—Ç–µ —Å–∏. –û—Å—Ç–∞–≤–∏ –≥–Ω–µ–≤–∞ –¥–∞ —Å–∏ –æ—Ç–∏–¥–µ –∏ —Å–µ —É—Å–ø–æ–∫–æ–π.","–ò—Å–∫–∞–º –¥–∞ —Ç–µ –ø—Ä–µ–≥—ä—Ä–Ω–∞ –∏ –¥–∞ –∏–∑–≥–æ–Ω—è —Ü–µ–ª–∏—è —Å—Ç—Ä–µ—Å. –¢–∏ —Å–∏ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–∞!","–°–≤–µ—Ç—ä—Ç –ø–æ–Ω—è–∫–æ–≥–∞ –µ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤, –Ω–æ —Ç–∏ —Å–∏ –ø–æ-—Å–∏–ª–Ω–∞ –æ—Ç –≤—Å—è–∫–æ –ø—Ä–µ–¥–∏–∑–≤–∏–∫–∞—Ç–µ–ª—Å—Ç–≤–æ.","–ù–µ–∫–∞ —Ç–æ–≤–∞ —á—É–≤—Å—Ç–≤–æ –ø—Ä–µ–º–∏–Ω–µ –ø—Ä–µ–∑ —Ç–µ–± –∏ —Å–∏ –æ—Ç–∏–¥–µ. –ó–∞—Å–ª—É–∂–∏–ª–∞ —Å–∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ.","–°–ø–æ–∫–æ–π–Ω–æ, –ª—é–±–æ–≤ –º–æ—è. –¢—É–∫ —Å—ä–º –¥–∞ —Ç–µ –∏–∑—Å–ª—É—à–∞–º, –∞–∫–æ –∏–º–∞—à –Ω—É–∂–¥–∞ –¥–∞ —Å–ø–æ–¥–µ–ª–∏—à.","–¢–∏ —Å–∏ –ø–æ-–¥–æ–±—Ä–∞ –æ—Ç —Ç–æ–≤–∞, –∫–æ–µ—Ç–æ —Ç–µ —è–¥–æ—Å–≤–∞. –§–æ–∫—É—Å–∏—Ä–∞–π —Å–µ –≤—ä—Ä—Ö—É —Ö—É–±–∞–≤–æ—Ç–æ.","–ù–µ –∑–∞–±—Ä–∞–≤—è–π, —á–µ —Ç–µ –æ–±–∏—á–∞–º –∏ —á–µ –∑–∞–µ–¥–Ω–æ –º–æ–∂–µ–º –¥–∞ —Å–µ —Å–ø—Ä–∞–≤–∏–º —Å –≤—Å–∏—á–∫–æ."] },
  tired:     { color:"#6BCB77", messages:["–î–Ω–µ—Å —Å–∏ –¥–∞–ª–∞ –≤—Å–∏—á–∫–æ –æ—Ç —Å–µ–±–µ —Å–∏. –í—Ä–µ–º–µ –µ –∑–∞ –ø–æ—á–∏–≤–∫–∞.","–¢–∏ —Å–∏ –∏—Å—Ç–∏–Ω—Å–∫–∞ —Å—É–ø–µ—Ä–∂–µ–Ω–∞, –Ω–æ –¥–æ—Ä–∏ –≥–µ—Ä–æ–∏—Ç–µ –∏–º–∞—Ç –Ω—É–∂–¥–∞ –æ—Ç –æ—Ç–¥–∏—Ö. –ü–æ—á–∏–Ω–∏ —Å–∏.","–í–∑–µ–º–∏ —Å–∏ —Å–Ω–∞–∫—á–µ, –ø—É—Å–Ω–∏ —Å–∏ –º—É–∑–∏–∫–∞ –∏ –∑–∞–±—Ä–∞–≤–∏ –∑–∞ –≤—Å–∏—á–∫–æ. –¢–∏ –≥–æ –∑–∞—Å–ª—É–∂–∞–≤–∞—à.","–¢–≤–æ—è—Ç —Ç—Ä—É–¥ –µ –∑–∞–±–µ–ª–µ–∂–∏—Ç–µ–ª–µ–Ω, –Ω–æ –∑–¥—Ä–∞–≤–µ—Ç–æ —Ç–∏ –µ –ø–æ-–≤–∞–∂–Ω–æ. –í—Ä–µ–º–µ –µ –∑–∞ —Ä–µ–ª–∞–∫—Å.","–ù–µ —Å–µ –Ω–∞—Å–∏–ª–≤–∞–π. –£—Ç—Ä–µ –µ –Ω–æ–≤ –¥–µ–Ω —Å –Ω–æ–≤–∏ —Å–∏–ª–∏. –°–µ–≥–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—á–∏–≤–∞–π.","–¢–∏ –ø—Ä–∞–≤–∏—à —Ç–æ–ª–∫–æ–≤–∞ –º–Ω–æ–≥–æ –∑–∞ –≤—Å–∏—á–∫–∏. –ù–∏–∫–æ–π –Ω—è–º–∞ –¥–∞ —Ç–µ —Å—ä–¥–∏ –∞–∫–æ —Å–∏ –≤–∑–µ–º–µ—à –ø–æ—á–∏–≤–∫–∞.","–ü—ä—Ç—è—Ç –∫—ä–º —É—Å–ø–µ—Ö–∞ –µ –∏–∑–º–æ—Ä–∏—Ç–µ–ª–µ–Ω, —Ç–æ—á–Ω–æ –∑–∞ —Ç–æ–≤–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –ø–æ—á–∏–≤–∫–∞—Ç–∞.","–°–≤–µ—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –ø–æ—á–∞–∫–∞. –°–µ–≥–∞ –µ —Ç–≤–æ–µ—Ç–æ –≤—Ä–µ–º–µ –∑–∞ —Ä–µ–ª–∞–∫—Å –∏ —É—é—Ç.","–ó–∞—Ç–≤–æ—Ä–∏ –æ—á–∏ –∏ —Å–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏ –Ω–µ—â–æ –∫—Ä–∞—Å–∏–≤–æ. –°–ø—Ä–∞–≤–∏ —Å–µ —Å—Ç—Ä–∞—Ö–æ—Ç–Ω–æ –¥–Ω–µ—Å!","–û–±–∏—á–∞–º —Ç–µ –∏ –∏—Å–∫–∞–º –¥–∞ —Ç–µ –≤–∏–¥—è –æ—Ç–ø–æ—á–∏–Ω–∞–ª–∞ –∏ —Å–≤–µ–∂–∞!"] },
  motivated: { color:"#FF9A3C", messages:["–¢–∏ –º–æ–∂–µ—à –≤—Å–∏—á–∫–æ! –í—è—Ä–≤–∞–º –≤ —Ç–≤–æ—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∏ –∑–Ω–∞–º, —á–µ —â–µ —É—Å–ø–µ–µ—à.","–ù–µ —Å–µ –æ—Ç–∫–∞–∑–≤–∞–π, —Ü–µ–ª—Ç–∞ –µ –±–ª–∏–∑–æ. –¢–≤–æ—è—Ç–∞ —É–ø–æ—Ä–∏—Ç–æ—Å—Ç –µ —Ç–≤–æ–µ—Ç–æ –Ω–∞–π-—Å–∏–ª–Ω–æ –æ—Ä—ä–∂–∏–µ.","–¢–∏ —Å–∏ —Ä–æ–¥–µ–Ω–∞ –¥–∞ –±–ª–µ—Å—Ç–∏—à. –í—Å—è–∫–∞ –º–∞–ª–∫–∞ —Å—Ç—ä–ø–∫–∞ —Ç–µ –≤–æ–¥–∏ –∫—ä–º –ø–æ–±–µ–¥–∞—Ç–∞.","–°–≤–µ—Ç—ä—Ç –∏–º–∞ –Ω—É–∂–¥–∞ –æ—Ç —Ç–∞–ª–∞–Ω—Ç–∞ —Ç–∏. –ü–æ–∫–∞–∂–∏ –Ω–∞ –∫–∞–∫–≤–æ —Å–∏ —Å–ø–æ—Å–æ–±–Ω–∞ –ª—é–±–æ–≤!","–ù—è–º–∞ –Ω–µ–≤—ä–∑–º–æ–∂–Ω–∏ –Ω–µ—â–∞ –∑–∞ —Ç–µ–±. –¢–∏ —Å–∏ —Å–∏–ª–Ω–∞, —É–º–Ω–∞ –∏ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å–º–µ–ª–∞.","–í—Å–µ–∫–∏ –¥–µ–Ω –µ –Ω–æ–≤–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –¥–∞ –±—ä–¥–µ—à –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ —Å–µ–±–µ —Å–∏.","–¢–≤–æ–∏—Ç–µ –º–µ—á—Ç–∏ –∑–∞—Å–ª—É–∂–∞–≤–∞—Ç –¥–∞ –±—ä–¥–∞—Ç —Ä–µ–∞–ª–Ω–æ—Å—Ç. –†–∞–±–æ—Ç–∏ –∑–¥—Ä–∞–≤–æ –∏ –≤—è—Ä–≤–∞–π –≤ —É—Å–ø–µ—Ö–∞.","–¢–∏ —Å–∏ –≤–¥—ä—Ö–Ω–æ–≤–µ–Ω–∏–µ –∑–∞ –º–µ–Ω. –ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π –¥–∞ —Ç–≤–æ—Ä–∏—à —Å–≤–æ—è—Ç–∞ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è.","–ë—ä–¥–∏ —Å–º–µ–ª–∞, –±—ä–¥–∏ –¥—Ä—ä–∑–∫–∞, –±—ä–¥–∏ —Å–µ–±–µ —Å–∏. –†–µ—Ü–µ–ø—Ç–∞—Ç–∞ –∑–∞ —É—Å–ø–µ—Ö –µ –≤ —Ç–µ–±.","–ù—è–º–∞ –Ω–µ–≤—ä–∑–º–æ–∂–Ω–∏ –Ω–µ—â–∞. –û–ø–∏—Ç–∞–π –æ—â–µ –µ–¥–∏–Ω –ø—ä—Ç!"] },
  insecure:  { color:"#FF6B9D", messages:["–ü–æ–º–Ω–∏, —á–µ —Å–∏ –Ω–∞–π-–∫—Ä–∞—Å–∏–≤–∏—è—Ç —á–æ–≤–µ–∫, –∫–æ–≥–æ—Ç–æ –ø–æ–∑–Ω–∞–≤–∞–º ‚Äì –∏ –æ—Ç–≤—ä—Ç—Ä–µ, –∏ –æ—Ç–≤—ä–Ω. –û–±–∏—á–∞–º —Ç–µ —Ç–æ—á–Ω–æ —Ç–∞–∫–∞–≤–∞!","–ù–µ —Å–µ —Å—ä–º–Ω—è–≤–∞–π –≤ —Å–µ–±–µ —Å–∏. –¢–≤–æ–∏—Ç–µ —Ç–∞–ª–∞–Ω—Ç–∏ –∏ —Ç–≤–æ–µ—Ç–æ —Å—ä—Ä—Ü–µ —Å–∞ –Ω–∞–ø—ä–ª–Ω–æ –Ω–µ–∑–∞–º–µ–Ω–∏–º–∏ –∏ —É–Ω–∏–∫–∞–ª–Ω–∏.","–î–æ—Ä–∏ –∫–æ–≥–∞—Ç–æ –Ω–µ –≥–æ –≤–∏–∂–¥–∞—à, —Ç–∏ –ø—Ä–∞–≤–∏—à —Å–≤–µ—Ç–∞ –ø–æ-–¥–æ–±—ä—Ä —Å–∞–º–æ —Å –ø—Ä–∏—Å—ä—Å—Ç–≤–∏–µ—Ç–æ —Å–∏. –¢–∏ —Å–∏ –±–µ–∑—Ü–µ–Ω–Ω–∞.","–û–±–∏—á–∞–º –≤—Å–∏—á–∫–æ –≤ —Ç–µ–±, –æ—Å–æ–±–µ–Ω–æ –º–∞–ª–∫–∏—Ç–µ –Ω–µ—â–∞, –∫–æ–∏—Ç–æ —Ç–∏ —Å–º—è—Ç–∞—à –∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç—ä—Ü–∏. –ó–∞ –º–µ–Ω —Å–∞ —Å—ä–≤—ä—Ä—à–µ–Ω–∏.","–¢–∏ —Å–∏ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–∞. –¢–æ—á–Ω–æ —Ç–∞–∫–∞–≤–∞, –∫–∞–∫–≤–∞—Ç–æ —Å–∏ –≤ —Ç–æ–∑–∏ –º–æ–º–µ–Ω—Ç ‚Äì —Ç–∏ —Å–∏ –≤—Å–∏—á–∫–æ, –æ—Ç –∫–æ–µ—Ç–æ –∏–º–∞–º –Ω—É–∂–¥–∞.","–°–≤–µ—Ç—ä—Ç –µ –ø–æ-–∫—Ä–∞—Å–∏–≤, –∑–∞—â–æ—Ç–æ —Ç–∏ —Å–∏ —á–∞—Å—Ç –æ—Ç –Ω–µ–≥–æ. –ù–µ –ø–æ–∑–≤–æ–ª—è–≤–∞–π –Ω–∞ –Ω–∏–∫–æ–µ —Å—ä–º–Ω–µ–Ω–∏–µ –¥–∞ —Ç–µ —Å–ø–∏—Ä–∞.","–ü—Ä–∏—Ç–µ–∂–∞–≤–∞—à –≤—ä—Ç—Ä–µ—à–Ω–∞ —Å–∏–ª–∞, –∫–æ—è—Ç–æ –º–æ–∂–µ –¥–∞ –ø–æ–±–µ–¥–∏ –≤—Å—è–∫–∞ –Ω–µ—Å–∏–≥—É—Ä–Ω–æ—Å—Ç. –ê–∑ –≤—è—Ä–≤–∞–º –≤ —Ç–µ–± –ø–æ–≤–µ—á–µ –æ—Ç –≤—Å–µ–∫–∏ –¥—Ä—É–≥.","–°–ø—Ä–∏ –¥–∞ —Å–ª—É—à–∞—à –¥—Ä—É–≥–∏—Ç–µ. –¢–∏ –ø—Ä–∏—Ç–µ–∂–∞–≤–∞—à –Ω–µ—â–æ –∫–æ–µ—Ç–æ —Ç–µ –Ω—è–º–∞—Ç –∏ –Ω—è–º–∞ –¥–∞ –∏–º–∞—Ç!","–¢–≤–æ—è—Ç–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –Ω–µ —Å–µ –æ–ø—Ä–µ–¥–µ–ª—è –æ—Ç —á—É–∂–¥–æ—Ç–æ –º–Ω–µ–Ω–∏–µ, –∞ –æ—Ç –¥–æ–±—Ä–æ—Ç–∞—Ç–∞ –∏ —Å–≤–µ—Ç–ª–∏–Ω–∞—Ç–∞ –≤ —Ç–µ–±.","–ö–æ–≥–∞—Ç–æ —Å–µ —á—É–≤—Å—Ç–≤–∞—à –º–∞–ª–∫–∞ –∏–ª–∏ –Ω–µ—Å–∏–≥—É—Ä–Ω–∞, –ø–æ–º–Ω–∏, —á–µ –∑–∞ –º–µ–Ω —Ç–∏ —Å–∏ —Ü–µ–ª–∏—è—Ç —Å–≤—è—Ç. –û–±–∏—á–∞–º —Ç–µ –±–µ–∑–∫—Ä–∞–π–Ω–æ!"] }
};

function initMoodTabs() {
  document.querySelectorAll('.mood-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.mood-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentMood = tab.dataset.mood;
      resetNote(); renderNotesPile();
    });
  });
}

function initJar() {
  document.getElementById('drawBtn').addEventListener('click', drawNote);
  document.getElementById('jarVisual').addEventListener('click', drawNote);
}

function renderNotesPile() {
  const pile = document.getElementById('notesPile'); pile.innerHTML = '';
  const cols = ['#FFD93D','#FF6B9D','#6BCB77','#90B4CE','#FF5757','#FF9A3C','#A855F7','#4ECDC4'];
  for (let i = 0; i < 9; i++) {
    const n = document.createElement('div'); n.className = 'mini-note';
    n.style.background = cols[i % cols.length];
    n.style.transform = `rotate(${-18 + Math.random() * 36}deg)`;
    pile.appendChild(n);
  }
}

function drawNote() {
  const m = NOTES[currentMood];
  if (!shownNotes[currentMood]) shownNotes[currentMood] = [];
  let av = m.messages.filter((_, i) => !shownNotes[currentMood].includes(i));
  if (!av.length) { shownNotes[currentMood] = []; av = [...m.messages]; }
  const msg = av[Math.floor(Math.random() * av.length)];
  shownNotes[currentMood].push(m.messages.indexOf(msg));
  const card = document.getElementById('noteCard');
  card.style.background = m.color;
  card.classList.remove('pop'); void card.offsetWidth; card.classList.add('pop');
  document.getElementById('noteText').textContent = msg;
  const jar = document.getElementById('jarVisual');
  jar.classList.add('shake'); setTimeout(() => jar.classList.remove('shake'), 500);
}

function resetNote() {
  document.getElementById('noteText').textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –≤—ä—Ä—Ö—É –±—É—Ä–∫–∞–Ω–∞ –∑–∞ –¥–∞ –∏–∑–≤–∞–¥–∏—à –ª–∏—Å—Ç—á–µ ‚ô°';
  document.getElementById('noteCard').style.background = '';
}

// ‚îÄ‚îÄ –°–ù–ò–ú–ö–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadPhotos() {
  const snap = await getDocs(query(collection(db, 'photos'), orderBy('createdAt', 'desc')));
  photos = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderGallery();
}

function renderGallery() {
  const grid = document.getElementById('galleryGrid');
  grid.innerHTML = '';
  if (!photos.length) {
    grid.innerHTML = '<div class="empty-msg">üì∏ –í—Å–µ –æ—â–µ –Ω—è–º–∞ —Å–Ω–∏–º–∫–∏ ‚Äî –±—ä–¥–∏ –ø—ä—Ä–≤–∏—è—Ç!</div>';
    return;
  }
  photos.forEach((p, i) => {
    const item = document.createElement('div'); item.className = 'gallery-item';
    item.innerHTML = `
      <img src="${p.url}" alt="${p.caption||''}" loading="lazy"/>
      <div class="gallery-overlay">
        <p class="gallery-caption">${p.caption||''}</p>
        ${p.date?`<span class="gallery-date">${p.date}</span>`:''}
      </div>
      <button class="del-btn" title="–ò–∑—Ç—Ä–∏–π">‚úï</button>`;
    item.querySelector('img').addEventListener('click', () => openLightbox(i));
    item.querySelector('.del-btn').addEventListener('click', e => {
      e.stopPropagation();
      if (confirm('–ò–∑—Ç—Ä–∏–π —Ç–∞–∑–∏ —Å–Ω–∏–º–∫–∞?')) deletePhoto(p.id);
    });
    grid.appendChild(item);
  });
}

function initPhotoForm() {
  // –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ —Å–Ω–∏–º–∫–∞—Ç–∞ –ø—Ä–∏ –≤—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ª–∏–Ω–∫
  document.getElementById('photoUrl').addEventListener('input', e => {
    const url = e.target.value.trim();
    const preview = document.getElementById('imgPreview');
    if (url.startsWith('http')) {
      preview.src = url;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  });

  document.getElementById('addPhotoBtn').addEventListener('click', async () => {
    const url = document.getElementById('photoUrl').value.trim();
    if (!url || !url.startsWith('http')) { showToast('–í—ä–≤–µ–¥–∏ –≤–∞–ª–∏–¥–µ–Ω –ª–∏–Ω–∫!'); return; }
    const btn = document.getElementById('addPhotoBtn');
    btn.disabled = true; btn.textContent = '–î–æ–±–∞–≤—è —Å–µ...';
    await addDoc(collection(db, 'photos'), {
      url,
      caption:   document.getElementById('photoCaption').value,
      date:      document.getElementById('photoDate').value,
      createdAt: Date.now()
    });
    document.getElementById('photoUrl').value = '';
    document.getElementById('photoCaption').value = '';
    document.getElementById('photoDate').value = '';
    document.getElementById('imgPreview').style.display = 'none';
    btn.disabled = false; btn.textContent = '–î–æ–±–∞–≤–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ üíï';
    showToast('–°–Ω–∏–º–∫–∞—Ç–∞ –µ –¥–æ–±–∞–≤–µ–Ω–∞! üíï');
    loadPhotos();
  });
}

async function deletePhoto(id) {
  await deleteDoc(doc(db, 'photos', id));
  showToast('–°–Ω–∏–º–∫–∞—Ç–∞ –µ –∏–∑—Ç—Ä–∏—Ç–∞.');
  loadPhotos();
}

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initLightbox() {
  document.getElementById('lightboxClose').addEventListener('click', closeLightbox);
  document.getElementById('lightboxPrev').addEventListener('click', () => navLightbox(-1));
  document.getElementById('lightboxNext').addEventListener('click', () => navLightbox(1));
  document.getElementById('lightbox').addEventListener('click', e => {
    if (e.target === document.getElementById('lightbox')) closeLightbox();
  });
  document.addEventListener('keydown', e => {
    if (!document.getElementById('lightbox').classList.contains('open')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') navLightbox(-1);
    if (e.key === 'ArrowRight') navLightbox(1);
  });
}
function openLightbox(i) {
  currentPhotoIdx = i; updateLightbox();
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.body.style.overflow = '';
}
function navLightbox(d) {
  currentPhotoIdx = (currentPhotoIdx + d + photos.length) % photos.length;
  updateLightbox();
}
function updateLightbox() {
  const p = photos[currentPhotoIdx];
  const img = document.getElementById('lightboxImg');
  img.style.opacity = '0';
  setTimeout(() => {
    img.src = p.url;
    document.getElementById('lightboxCaption').textContent = [p.caption, p.date].filter(Boolean).join(' ¬∑ ');
    img.style.opacity = '1';
  }, 150);
}

// ‚îÄ‚îÄ –ò–°–¢–û–†–ò–ô–ö–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadStories() {
  const snap = await getDocs(query(collection(db, 'stories'), orderBy('createdAt', 'desc')));
  stories = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderStories();
}

function renderStories() {
  const grid = document.getElementById('storiesGrid');
  grid.innerHTML = '';
  if (!stories.length) {
    grid.innerHTML = '<div class="empty-msg">‚úçÔ∏è –í—Å–µ –æ—â–µ –Ω—è–º–∞ –∏—Å—Ç–æ—Ä–∏–π–∫–∏ ‚Äî –Ω–∞–ø–∏—à–∏ –ø—ä—Ä–≤–∞—Ç–∞!</div>';
    return;
  }
  const colors = ['#FFD93D','#FF6B9D','#6BCB77','#90B4CE','#FF9A3C','#A855F7'];
  stories.forEach((s, i) => {
    const card = document.createElement('div'); card.className = 'story-card';
    card.style.borderTopColor = colors[i % colors.length];
    card.innerHTML = `
      <div class="story-emoji">${s.emoji||'‚ú®'}</div>
      ${s.date?`<span class="story-date">${s.date}</span>`:''}
      <h3 class="story-title">${s.title}</h3>
      <p class="story-preview">${s.preview||''}</p>
      <button class="story-read-btn">–ø—Ä–æ—á–µ—Ç–∏ ‚ô°</button>
      <button class="story-del-btn" title="–ò–∑—Ç—Ä–∏–π">‚úï</button>`;
    card.querySelector('.story-read-btn').addEventListener('click', () => openStory(i));
    card.querySelector('.story-del-btn').addEventListener('click', () => {
      if (confirm('–ò–∑—Ç—Ä–∏–π –∏—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞?')) deleteStory(s.id);
    });
    grid.appendChild(card);
  });
}

function initStoryForm() {
  document.getElementById('addStoryBtn').addEventListener('click', async () => {
    const title   = document.getElementById('storyTitle').value.trim();
    const content = document.getElementById('storyContent').value.trim();
    if (!title || !content) { showToast('–î–æ–±–∞–≤–∏ –ø–æ–Ω–µ –∑–∞–≥–ª–∞–≤–∏–µ –∏ —Ç–µ–∫—Å—Ç!'); return; }
    const btn = document.getElementById('addStoryBtn');
    btn.disabled = true; btn.textContent = '–ó–∞–ø–∞–∑–≤–∞ —Å–µ...';
    await addDoc(collection(db, 'stories'), {
      title, content,
      preview:   document.getElementById('storyPreview').value.trim(),
      emoji:     document.getElementById('storyEmoji').value || '‚ú®',
      date:      document.getElementById('storyDate').value,
      createdAt: Date.now()
    });
    ['storyTitle','storyContent','storyPreview','storyEmoji','storyDate']
      .forEach(id => document.getElementById(id).value = '');
    btn.disabled = false; btn.textContent = '–ó–∞–ø–∞–∑–∏ –∏—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞ üíï';
    showToast('–ò—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞ –µ –∑–∞–ø–∞–∑–µ–Ω–∞! üíï');
    loadStories();
  });
}

async function deleteStory(id) {
  await deleteDoc(doc(db, 'stories', id));
  showToast('–ò—Å—Ç–æ—Ä–∏–π–∫–∞—Ç–∞ –µ –∏–∑—Ç—Ä–∏—Ç–∞.');
  loadStories();
}

function initStoryModal() {
  document.getElementById('storyClose').addEventListener('click', closeStory);
  document.getElementById('storyModal').addEventListener('click', e => {
    if (e.target === document.getElementById('storyModal')) closeStory();
  });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeStory(); });
}
function openStory(i) {
  const s = stories[i];
  document.getElementById('storyModalContent').innerHTML = `
    <div class="story-modal-emoji">${s.emoji||'‚ú®'}</div>
    <h2 class="story-modal-title">${s.title}</h2>
    ${s.date?`<p class="story-modal-date">${s.date}</p>`:''}
    <div class="story-modal-body">${s.content}</div>`;
  document.getElementById('storyModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeStory() {
  document.getElementById('storyModal').classList.remove('open');
  document.body.style.overflow = '';
}

function initNavSmooth() {
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      document.querySelector(link.getAttribute('href'))?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>